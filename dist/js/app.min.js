var myApp=angular.module("demoApp",["ui.router","config","ngStorage","ngMaterial"]).config(function($httpProvider,$locationProvider){$locationProvider.html5Mode(!0).hashPrefix("!"),$httpProvider.defaults.useXDomain=!0,delete $httpProvider.defaults.headers.common["X-Requested-With"]}).run(function($rootScope,ENV,CONFIG){$rootScope.appConfig=CONFIG[ENV],/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&angular.element("html").addClass("ismobile")}),configData={ENV:"PROD",APP_NAME:"My App",APP_VERSION:"0.1",CONFIG:{PROD:{THEME:"DemoApp"},DEV:{THEME:"DemoApp"}}},configModule=angular.module("config",[]);angular.forEach(configData,function(key,value){configModule.constant(value,key)}),myApp.controller("mainCtrl",["$scope","$localStorage","$window","Point",function($scope,$localStorage,$window,Point){$scope.points=[],$scope.display=!1,$scope.createPoint=function(e){var p=new Point(e.layerX,e.layerY);$scope.points.push(p)},$scope.removePoint=function(point){$scope.points=$scope.points.filter(function(p){return p.id!==point.id})},$scope.showPoints=function(e){var shape=document.getElementById("shape"),rect=shape.getBoundingClientRect(),doc=shape.ownerDocument,docElem=doc.documentElement,x1=rect.left+$window.pageXOffset-docElem.clientLeft,x2=x1+shape.offsetWidth,y1=rect.top+$window.pageYOffset-docElem.clientTop,y2=y1+shape.offsetHeight;e.clientX>=x1&&e.clientX<=x2&&e.clientY>=y1&&e.clientY<=y2?$scope.display=!0:$scope.display=!1},$scope.hidePoints=function(){$scope.display=!1}}]),myApp.directive("pointHTML",function(){return{templateUrl:"/themes/DemoApp/point.html",replace:!1,controller:["$scope",function($scope){$scope.point=void 0===$scope.point?{}:$scope.point,$scope.comment="",$scope.preAddComment=function(){$scope.point.addComment($scope.comment),$scope.comment=""},$scope.preRemoveComment=function(comment){$scope.point.removeComment(comment)},$scope.preEditComment=function(comment){$scope.point.editComment(comment)},$scope.preSaveComment=function(comment){$scope.point.saveComment(comment)}}]}}),myApp.factory("Comment",function(){function Comment(text,created,user){this.id=(new Date).getTime(),this.text=text,this.time=moment.unix(created).format("MM/DD/YYYY hh:mm"),this.user=user,this.status="published"}return Comment}).factory("Point",function(Comment){function Point(x,y){this.id=(new Date).getTime(),this.x=x,this.y=y,this.r=30,this.show=0,this.comments=[]}return Point.prototype={addComment:function(text){var c=new Comment(text,Math.floor(Date.now()/1e3),"Who i am...");this.comments.push(c)},removeComment:function(comment){this.comments=this.comments.filter(function(c){return comment.id!=c.id})},editComment:function(comment){this.comments.filter(function(c){return comment.id==c.id})[0].status="edit"},saveComment:function(comment){this.comments.filter(function(c){return comment.id==c.id})[0].status="published"}},Point}),myApp.config(function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("home",{url:"/",templateUrl:"/themes/DemoApp/home.html"})});